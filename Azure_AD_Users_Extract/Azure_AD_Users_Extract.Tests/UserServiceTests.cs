using System;
using System.Threading.Tasks;
using Azure_AD_Users_Extract.Services;
using Microsoft.Extensions.Configuration;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Moq;

namespace Azure_AD_Users_Extract.Tests
{
    [TestClass]
    public class UserServiceTests
    {
        [DataTestMethod]
        [DataRow(" ",  "good", 1)]
        [DataRow("",   "good", 1)]
        [DataRow(null, "good", 1)]
        [DataRow("good", " ",  1)]
        [DataRow("good", "",   1)]
        [DataRow("good", null, 1)]
        [DataRow("good", "good", -1)]
        [ExpectedException(typeof(ArgumentOutOfRangeException))]
        public async Task GetUsers_InvalidInputThrowException(string groupId, string token, int syncDurationInHours)
        {
            // ARRANGE
            var configurationMock = new Mock<IConfiguration>();
            var graphApiServiceMock = new Mock<IGraphApiService>();
            var unitUnderTest = new UserService(configurationMock.Object, graphApiServiceMock.Object);

            // ACT
            var _ = await unitUnderTest.GetUsers(groupId, token, syncDurationInHours);
        }

        [TestMethod]
        public async Task GetUsers_Success()
        {
            // ARRANGE
            var firstJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"@odata.nextLink\": \"https://graph.microsoft.com/beta/groups/84e9e58d-76d9-42aa-996d-be88be7a40e5/members?$skiptoken=X%27445370740900000000000000000000140000007F852FC15BCC5A47B4899881D1EF36A202000000000000000000000000000017312E322E3834302E3131333535362E312E342E3233333102000000000001250DB3203FDE5C4B8544CBA956C74EC6%27\",\"value\":[{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\"}]}";
            var secondJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"value\":[{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\"}]}";
            var configurationMock = new Mock<IConfiguration>();
            var graphApiServiceMock = new Mock<IGraphApiService>();
            var unitUnderTest = new UserService(configurationMock.Object, graphApiServiceMock.Object);
            var token = "TOKEN";

            var sequence = new MockSequence();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => firstJsonResult).Verifiable();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => secondJsonResult).Verifiable();

            var offsetDate = new DateTimeOffset(2019, 08, 19, 1, 1, 1, TimeSpan.Zero);
            var delta = DateTimeOffset.UtcNow.Subtract(offsetDate);
            var hours = (int)delta.TotalHours;

            // ACT
            var results = await unitUnderTest.GetUsers("GROUPID", token, hours);

            // ASSERT
            graphApiServiceMock.Verify();
            Assert.IsNotNull(results);
            Assert.AreEqual(2, results.Count);
        }

        [TestMethod]
        public async Task GetUsers_WithZeroDurationSuccess()
        {
            // ARRANGE
            var firstJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"@odata.nextLink\": \"https://graph.microsoft.com/beta/groups/84e9e58d-76d9-42aa-996d-be88be7a40e5/members?$skiptoken=X%27445370740900000000000000000000140000007F852FC15BCC5A47B4899881D1EF36A202000000000000000000000000000017312E322E3834302E3131333535362E312E342E3233333102000000000001250DB3203FDE5C4B8544CBA956C74EC6%27\",\"value\":[{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\"}]}";
            var secondJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"value\":[{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\"}]}";
            var configurationMock = new Mock<IConfiguration>();
            var graphApiServiceMock = new Mock<IGraphApiService>();
            var unitUnderTest = new UserService(configurationMock.Object, graphApiServiceMock.Object);
            var token = "TOKEN";

            var sequence = new MockSequence();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => firstJsonResult).Verifiable();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => secondJsonResult).Verifiable();

            // ACT
            var results = await unitUnderTest.GetUsers("GROUPID", token);

            // ASSERT
            graphApiServiceMock.Verify();
            Assert.IsNotNull(results);
            Assert.AreEqual(38, results.Count);
        }


        [TestMethod]
        public async Task GetUsers_WithAGroupSuccess()
        {
            // ARRANGE
            var firstJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"@odata.nextLink\": \"https://graph.microsoft.com/beta/groups/84e9e58d-76d9-42aa-996d-be88be7a40e5/members?$skiptoken=X%27445370740900000000000000000000140000007F852FC15BCC5A47B4899881D1EF36A202000000000000000000000000000017312E322E3834302E3131333535362E312E342E3233333102000000000001250DB3203FDE5C4B8544CBA956C74EC6%27\",\"value\":[{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\"}]}";
            var secondJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"value\":[{\"@odata.type\":\"#microsoft.graph.group\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\"}]}";
            var thirdJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"value\":[{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\"}]}";
            var configurationMock = new Mock<IConfiguration>();
            var graphApiServiceMock = new Mock<IGraphApiService>();
            var unitUnderTest = new UserService(configurationMock.Object, graphApiServiceMock.Object);
            var token = "TOKEN";

            var sequence = new MockSequence();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => firstJsonResult).Verifiable();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => secondJsonResult).Verifiable();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => thirdJsonResult).Verifiable();

            var offsetDate = new DateTimeOffset(2019, 08, 19, 1, 1, 1, TimeSpan.Zero);
            var delta = DateTimeOffset.UtcNow.Subtract(offsetDate);
            var hours = (int)delta.TotalHours;

            // ACT
            var results = await unitUnderTest.GetUsers("GROUPID", token, hours);

            // ASSERT
            graphApiServiceMock.Verify();
            Assert.IsNotNull(results);
            Assert.AreEqual(3, results.Count);
        }

        [DataTestMethod]
        [DataRow(" ",  1)]
        [DataRow("",   1)]
        [DataRow(null, 1)]
        [DataRow("good", -1)]
        [ExpectedException(typeof(ArgumentOutOfRangeException))]
        public async Task GetDeactivatedUsers_InvalidInputThrowException(string token, int syncDurationInHours)
        {
            // ARRANGE
            var configurationMock = new Mock<IConfiguration>();
            var graphApiServiceMock = new Mock<IGraphApiService>();
            var unitUnderTest = new UserService(configurationMock.Object, graphApiServiceMock.Object);

            // ACT
            var _ = await unitUnderTest.GetDeactivatedUsers(token, syncDurationInHours);
        }

        [TestMethod]
        public async Task GetDeactivatedUsers_Success()
        {
            // ARRANGE
            var firstJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"@odata.nextLink\": \"https://graph.microsoft.com/beta/groups/84e9e58d-76d9-42aa-996d-be88be7a40e5/members?$skiptoken=X%27445370740900000000000000000000140000007F852FC15BCC5A47B4899881D1EF36A202000000000000000000000000000017312E322E3834302E3131333535362E312E342E3233333102000000000001250DB3203FDE5C4B8544CBA956C74EC6%27\",\"value\":[{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\"}]}";
            var secondJsonResult = "{\"@odata.context\":\"https://graph.microsoft.com/v1.0/$metadata#directoryObjects\",\"value\":[{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"4782e723-f4f4-4af3-a76e-25e3bab0d896\",\"businessPhones\":[\"+1 858 555 0110\"],\"displayName\":\"Alex Wilber\",\"givenName\":\"Alex\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"AlexW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilber\",\"userPrincipalName\":\"AlexW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"40079818-3808-4585-903b-02605f061225\",\"businessPhones\":[\"+1 502 555 0144\"],\"displayName\":\"Patti Fernandez\",\"givenName\":\"Patti\",\"jobTitle\":\"President\",\"mail\":\"PattiF@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"15/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Fernandez\",\"userPrincipalName\":\"PattiF@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"ec63c778-24e1-4240-bea3-d12a167d5232\",\"businessPhones\":[\"+20 255501070\"],\"displayName\":\"Pradeep Gupta\",\"givenName\":\"Pradeep\",\"jobTitle\":\"Accountant II\",\"mail\":\"PradeepG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"98/2202\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gupta\",\"userPrincipalName\":\"PradeepG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"8b209ac8-08ff-4ef1-896d-3b9fde0bbf04\",\"businessPhones\":[\"+1 980 555 0101\"],\"displayName\":\"Joni Sherman\",\"givenName\":\"Joni\",\"jobTitle\":\"Paralegal\",\"mail\":\"JoniS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Sherman\",\"userPrincipalName\":\"JoniS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"b66ecf79-a093-4d51-86e0-efcc4531f37a\",\"businessPhones\":[\"+1 858 555 0111\"],\"displayName\":\"Christie Cline\",\"givenName\":\"Christie\",\"jobTitle\":\"Sr. VP Sales & Marketing\",\"mail\":\"ChristieC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2105\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cline\",\"userPrincipalName\":\"ChristieC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"626cbf8c-5dde-46b0-8385-9e40d64736fe\",\"businessPhones\":[\"+1 502 555 0102\"],\"displayName\":\"Johanna Lorenz\",\"givenName\":\"Johanna\",\"jobTitle\":\"CVP Engineering\",\"mail\":\"JohannaL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/2102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Lorenz\",\"userPrincipalName\":\"JohannaL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"16cfe710-1625-4806-9990-91b8f0afee35\",\"businessPhones\":[\"+1 205 555 0103\"],\"displayName\":\"Enrico Cattaneo\",\"givenName\":\"Enrico\",\"jobTitle\":\"Attorney\",\"mail\":\"EnricoC@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1102\",\"preferredLanguage\":\"en-US\",\"surname\":\"Cattaneo\",\"userPrincipalName\":\"EnricoC@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"089a6bb8-e8cb-492c-aa41-c078aa0b5120\",\"businessPhones\":[\"+1 206 555 0105\"],\"displayName\":\"Nestor Wilke\",\"givenName\":\"Nestor\",\"jobTitle\":\"CVP Operations\",\"mail\":\"NestorW@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"36/2121\",\"preferredLanguage\":\"en-US\",\"surname\":\"Wilke\",\"userPrincipalName\":\"NestorW@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e3d0513b-449e-4198-ba6f-bd97ae7cae85\",\"businessPhones\":[\"+1 918 555 0101\"],\"displayName\":\"Isaiah Langer\",\"givenName\":\"Isaiah\",\"jobTitle\":\"Web Marketing Manager\",\"mail\":\"IsaiahL@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Langer\",\"userPrincipalName\":\"IsaiahL@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"87d349ed-44d7-43e1-9a83-5f2406dee5bd\",\"businessPhones\":[\"+1 425 555 0109\"],\"displayName\":\"Adele Vance\",\"givenName\":\"Adele\",\"jobTitle\":\"Product Marketing Manager\",\"mail\":\"AdeleV@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/2111\",\"preferredLanguage\":\"en-US\",\"surname\":\"Vance\",\"userPrincipalName\":\"AdeleV@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"074e56ea-0b50-4461-89e5-c67ae14a2c0b\",\"businessPhones\":[\"+1 913 555 0101\"],\"displayName\":\"Lee Gu\",\"givenName\":\"Lee\",\"jobTitle\":\"CVP Research & Development\",\"mail\":\"LeeG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"23/3101\",\"preferredLanguage\":\"en-US\",\"surname\":\"Gu\",\"userPrincipalName\":\"LeeG@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2804bc07-1e1f-4938-9085-ce6d756a32d2\",\"businessPhones\":[\"+81 345550115\"],\"displayName\":\"Emily Braun\",\"givenName\":\"Emily\",\"jobTitle\":\"Budget Analyst\",\"mail\":\"EmilyB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"97/2302\",\"preferredLanguage\":\"en-US\",\"surname\":\"Braun\",\"userPrincipalName\":\"EmilyB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"48d31887-5fad-4d73-a9f5-3c356e68a038\",\"businessPhones\":[\"+1 412 555 0109\"],\"displayName\":\"Megan Bowen\",\"givenName\":\"Megan\",\"jobTitle\":\"Auditor\",\"mail\":\"MeganB@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"12/1110\",\"preferredLanguage\":\"en-US\",\"surname\":\"Bowen\",\"userPrincipalName\":\"MeganB@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"e8a02cc7-df4d-4778-956d-784cc9506e5a\",\"businessPhones\":[\"+1 918 555 0104\"],\"displayName\":\"Lynne Robbins\",\"givenName\":\"Lynne\",\"jobTitle\":\"Product Manager\",\"mail\":\"LynneR@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/1104\",\"preferredLanguage\":\"en-US\",\"surname\":\"Robbins\",\"userPrincipalName\":\"LynneR@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"c8913c86-ceea-4d39-b1ea-f63a5b675166\",\"businessPhones\":[\"+1 954 555 0118\"],\"displayName\":\"Henrietta Mueller\",\"givenName\":\"Henrietta\",\"jobTitle\":\"Marketing Assistant\",\"mail\":\"HenriettaM@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"18/1106\",\"preferredLanguage\":\"en-US\",\"surname\":\"Mueller\",\"userPrincipalName\":\"HenriettaM@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"df043ff1-49d5-414e-86a4-0c7f239c36cf\",\"businessPhones\":[\"+1 309 555 0104\"],\"displayName\":\"Grady Archie\",\"givenName\":\"Grady\",\"jobTitle\":\"CVP Legal\",\"mail\":\"GradyA@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"19/2109\",\"preferredLanguage\":\"en-US\",\"surname\":\"Archie\",\"userPrincipalName\":\"GradyA@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"2ed03dfd-01d8-4005-a9ef-fa8ee546dc6c\",\"businessPhones\":[\"+1 918 555 0107\"],\"displayName\":\"Lidia Holloway\",\"givenName\":\"Lidia\",\"jobTitle\":\"Product Manager\",\"mail\":\"LidiaH@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"20/2107\",\"preferredLanguage\":\"en-US\",\"surname\":\"Holloway\",\"userPrincipalName\":\"LidiaH@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"24fcbca3-c3e2-48bf-9ffc-c7f81b81483d\",\"businessPhones\":[\"+1 205 555 0108\"],\"displayName\":\"Diego Siciliani\",\"givenName\":\"Diego\",\"jobTitle\":\"CVP Finance\",\"mail\":\"DiegoS@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"14/1108\",\"preferredLanguage\":\"en-US\",\"surname\":\"Siciliani\",\"userPrincipalName\":\"DiegoS@M365x214355.onmicrosoft.com\"},{\"@odata.type\":\"#microsoft.graph.user\",\"id\":\"08fa38e4-cbfa-4488-94ed-c834da6539df\",\"businessPhones\":[\"+1 858 555 0109\"],\"displayName\":\"Miriam Graham\",\"givenName\":\"Miriam\",\"jobTitle\":\"VP Marketing\",\"mail\":\"MiriamG@M365x214355.onmicrosoft.com\",\"mobilePhone\":null,\"officeLocation\":\"131/2103\",\"preferredLanguage\":\"en-US\",\"surname\":\"Graham\",\"userPrincipalName\":\"MiriamG@M365x214355.onmicrosoft.com\",\"onPremisesLastSyncDateTime\":\"2019-08-20T17:30:20Z\",\"onPremisesExtensionAttributes\":{\"extensionAttribute1\":\"False\",\"extensionAttribute2\":\"False\",\"extensionAttribute3\":null,\"extensionAttribute4\":\"Central\",\"extensionAttribute5\":\"372\",\"extensionAttribute6\":\"2015-01-01T08:00:00.000\",\"extensionAttribute7\":\"2017-08-25T13:59:38.000\",\"extensionAttribute8\":\"2019-09-25T13:59:38.000\",\"extensionAttribute9\":null,\"extensionAttribute10\":null,\"extensionAttribute11\":null,\"extensionAttribute12\":null,\"extensionAttribute13\":null,\"extensionAttribute14\":null,\"extensionAttribute15\":null}}]}";
            var configurationMock = new Mock<IConfiguration>();
            var graphApiServiceMock = new Mock<IGraphApiService>();
            var unitUnderTest = new UserService(configurationMock.Object, graphApiServiceMock.Object);
            var token = "TOKEN";

            var sequence = new MockSequence();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => firstJsonResult).Verifiable();
            graphApiServiceMock.InSequence(sequence).Setup(mock => mock.RetrieveData(It.IsAny<string>(), token)).ReturnsAsync(() => secondJsonResult).Verifiable();

            var offsetDate = new DateTimeOffset(2019, 08, 19, 1, 1, 1, TimeSpan.Zero);
            var delta = DateTimeOffset.UtcNow.Subtract(offsetDate);
            var hours = (int)delta.TotalHours;

            // ACT
            var results = await unitUnderTest.GetDeactivatedUsers(token, hours);

            // ASSERT
            graphApiServiceMock.Verify();
            Assert.IsNotNull(results);
            Assert.AreEqual(1, results.Count);
        }
    }
}
